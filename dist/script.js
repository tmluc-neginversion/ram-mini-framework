/* © 2025 Ricardo Alonso Mendiola — MIT License */
async function frameworkOnLoad(){selectPage(document.getElementById("page-1")),await importDependency({name:"SweetAlert2",js:"https://cdn.jsdelivr.net/npm/sweetalert2@11"}),await importDependency({name:"SlimSelect",css:"https://cdn.jsdelivr.net/npm/slim-select@2/dist/slimselect.css",js:"https://cdn.jsdelivr.net/npm/slim-select@2/dist/slimselect.min.js"})}async function importDependency({name:e,css:t,js:n}){if(t&&!document.querySelector(`link[href*="${t}"]`)){let l=document.createElement("link");l.rel="stylesheet",l.href=t,document.head.appendChild(l)}return n&&!document.querySelector(`script[src*="${n}"]`)&&await new Promise((t,l)=>{let o=document.createElement("script");o.src=n,o.async=!0,o.onload=t,o.onerror=()=>l(Error(`❌ Failed to load ${e}!`)),document.head.appendChild(o)}),console.log(`✅ ${e} loaded!`),!0}function selectPage(e){let t=document.getElementById("app-script-forms");t.querySelectorAll(".forms-page").forEach(e=>{e.style.display="none"}),e.style.display="block",document.getElementById("header").scrollIntoView({behavior:"smooth"})}async function nextPage(e,t,n=!0){let l=document.getElementById("page-"+e),o=document.getElementById("page-"+t);if(n){if(t>e){if(!checkInputs(l)){await Swal.fire({title:"⚠️ Atenci\xf3n",text:"Por favor, completa todos los campos antes de continuar.",icon:"warning",confirmButtonText:"Aceptar"}),document.getElementById("header").scrollIntoView({behavior:"smooth"});return}}else{let r=await Swal.fire({title:"⚠️ Atenci\xf3n",text:"Si haces cambios en la secci\xf3n anterior podr\xedas perder informaci\xf3n ya ingresada en esta secci\xf3n.",icon:"warning",showCancelButton:!0,confirmButtonText:"Aceptar",cancelButtonText:"Cancelar"});if(r.isDismissed)return!1}}selectPage(o)}function checkInputs(e){let t=!0;return e.querySelectorAll("input, select, textarea").forEach(e=>{let n=e;e instanceof HTMLSelectElement&&(n=e.closest(".custom-select")),n||(n=e),e.value?myBorder(n):(n.style.border="2px solid red",t=!1)}),t}function fillSelect(e,t,n=!1,l=!1){let o=t.map(e=>"string"==typeof e?{value:e,text:e}:e);l&&o.sort((e,t)=>e.text.localeCompare(t.text,"es",{numeric:!0})),n?(e.slim||(e.slim=new SlimSelect({select:e,settings:{allowDeselect:!0,searchHighlight:!0,searchPlaceholder:"Busca…",searchText:"No hay resultados",searchingText:"Buscando…",placeholderText:"-- Selecciona --"}})),e.slim.setData(o),e.multiple?e.slim.setSelected([]):(e.selectedIndex=-1,e.slim.setSelected())):(e.innerHTML="<option value=''>-- Selecciona --</option>",o.forEach(t=>{let n=document.createElement("option");n.value=t.value,n.text=t.text,e.appendChild(n)}))}function clearSelects(e,t){e.forEach(e=>{e.innerHTML="",e.slim?(console.log(e.slim),e.slim.setData([]),e.slim.settings.placeholderText=t.toUpperCase(),e.slim.setSelected()):e.innerHTML="<option value=''>"+t+"</option>"})}function addHeader(e,t){let n=document.getElementById(e),l=document.getElementById(t).content.cloneNode(!0);n.appendChild(l)}function addRow(e,t){let n=document.getElementById(e),l=document.getElementById(t).content.cloneNode(!0).querySelector("tr"),o=n.rows.length,r=l.querySelector(".row-delete");r&&(0===o?(r.disabled=!0,r.title="Debe contener al menos un registro."):r.addEventListener("click",()=>{removeRow(r)})),n.appendChild(l)}function removeRow(e){e.closest("tr").remove()}function myRound(e,t){return Math.round(e*10**t)/10**t}function myBorder(e){e.style.border="2px solid var(--c-text)"}function myMoneyFormat(e){return new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN",minimumFractionDigits:2,maximumFractionDigits:2}).format(e)}function myTotal(e,t){let n=0;t.forEach(e=>{n+=parseFloat(e?.value)||0}),e.innerHTML="TOTAL: "+myMoneyFormat(n)}function myDate(e){let t=e.substring(8,10)+"/"+["","ENE","FEB","MAR","ABR","MAY","JUN","JUL","AGO","SEP","OCT","NOV","DIC"][parseInt(e.substring(5,7),10)]+"/"+e.substring(0,4);return t}document.addEventListener("DOMContentLoaded",frameworkOnLoad);
